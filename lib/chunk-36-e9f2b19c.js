"use strict";(globalThis.webpackChunk_croquet_microverse=globalThis.webpackChunk_croquet_microverse||[]).push([[36],{3036:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});const s={modules:[{name:"PropertySheet",actorBehaviors:[class PropertySheetActor{setup(){this.windows&&this.windows.forEach(e=>e.destroy()),this.windows=[],this.dismiss&&this.dismiss.destroy();let e=this._cardData.width,t=this._cardData.height;this.dismiss=this.createCard({translation:[e/2-.05,t/2-.05,.041],name:"dismiss",behaviorModules:["PropertySheetDismiss"],parent:this,type:"object",noSave:!0}),this.subscribe(this.dismiss.id,"dismiss","dismissSheet")}dismissSheet(e){this.dismiss&&this.dismiss.destroy(),this.windows&&this.windows.forEach(e=>e.destroy()),this.destroy()}newWindow(e,t){let i=this.createCard({name:"window",behaviorModules:["PropertySheetWindow"],parent:this,width:e.x,height:e.y,type:"object",noSave:!0});return i.set({translation:[t.x,t.y,.05]}),i}setObject(e){console.log("setObject"),this.target=e,this.menuWindow=this.newWindow({x:1,y:1.5},{x:.9,y:.4}),this.behaviorMenu=this.createCard({name:"behavior menu",behaviorModules:["BehaviorMenu"],translation:[0,0,.08],width:this.menuWindow._cardData.width,height:this.menuWindow._cardData.height,type:"object",parent:this.menuWindow,noSave:!0,target:e.id}),this.subscribe(this.behaviorMenu.id,"extentChanged","menuExtentChanged"),this.behaviorMenu.call("BehaviorMenu$BehaviorMenuActor","show"),this.cardSpecWindow=this.newWindow({x:1.7,y:2.8},{x:-.4,y:0}),this.cardSpec=this.createCard({className:"TextFieldActor",name:"card spec",translation:[0,0,.025],parent:this.cardSpecWindow,type:"text",multiuser:!0,margins:{left:8,top:8,right:8,bottom:8},textScale:.0014,backgroundColor:16777215,width:1.66,height:2.76,depth:.002,autoResize:!1,noDismissButton:!0,borderRadius:.013,fullBright:!0,cornerRadius:0,runs:[{text:""}],noSave:!0});var t=this.cardSpecString(e);this.cardSpec.loadAndReset(t),this.subscribe(this.cardSpec.id,"text","cardSpecAccept"),this.actionMenuWindow=this.newWindow({x:.8,y:.6},{x:.9,y:-1.1}),this.actionMenu=this.createCard({name:"action menu",behaviorModules:["ActionMenu"],translation:[0,0,.08],width:this.actionMenuWindow._cardData.width,height:this.actionMenuWindow._cardData.height,type:"object",parent:this.actionMenuWindow,noSave:!0,target:e.id}),this.subscribe(this.actionMenu.id,"extentChanged","actionMenuExtentChanged"),this.subscribe(this.actionMenu.id,"doAction","doAction"),this.actionMenu.call("ActionMenu$ActionMenuActor","show"),this.listen("dismiss","dismiss")}menuExtentChanged(e){this.menuWindow&&this.menuWindow.setCardData({width:e.x+.05,height:e.y+.05})}actionMenuExtentChanged(e){this.actionMenuWindow&&this.actionMenuWindow.setCardData({width:e.x+.05,height:e.y+.05})}doAction(e){if(this.target)return"Delete"===e.action?(this.target.destroy(),void this.destroy()):void("Duplicate"===e.action?this.target.duplicate(e):"Save"===e.action&&this.target.saveCard(e))}cardSpecString(e){let i=e.collectCardData(),s=this.intrinsicProperties(),a=[],t=(s.forEach(e=>{var t=i[e];void 0!==t&&(a.push("    "),a.push(e),a.push(": "),a.push(this.specValue(e,t)),a.push(",\n"))}),Object.keys(i));return t.sort(),t.forEach(e=>{var t;s.includes(e)||(t=i[e],a.push("    "),a.push(e),a.push(": "),a.push(this.specValue(e,t)),a.push(",\n"))}),a.join("")}specValue(e,t){if(Array.isArray(t)){let e=t.map(e=>JSON.stringify(e));return`[${e.join(", ")}]`}return JSON.stringify(t)}cardSpecAccept(e){let t=e["text"],i=t.split("\n"),s=/^[ \t]*([^:]+)[ \t]*:[ \t]*(.*)$/,a={},r=!1;i.forEach(t=>{t=s.exec(t);if(t){r=!0;var i=t[1];let e=t[2];e&&e.endsWith(",")&&(e=e.slice(0,e.length-1));try{e=JSON.parse(e)}catch(e){console.log(e)}"rotation"!==i&&"dataRotation"!==i||Array.isArray(e)&&3===e.length&&(e=Worldcore.q_euler(...e)),a[i]=e}}),r&&!this.target.doomed&&this.target.updateOptions(a)}}],pawnBehaviors:[class PropertySheetPawn{setup(){this.frame&&(this.shape.remove(this.frame),this.frame=null),this.back&&(this.shape.remove(this.back),this.back=null),this.shape.children=[];var e={x:this.actor._cardData.width,y:this.actor._cardData.height},t=this.roundedCornerGeometry(e.x,e.y,.04,.02),i=this.makePlaneMaterial(.02,13421772,13421772,!1),t=(this.frame=new Worldcore.THREE.Mesh(t,i),this.shape.add(this.frame),this.roundedCornerGeometry(e.x-.02,e.y-.02,1e-4,.02)),i=this.makePlaneMaterial(.02,5395026,5395026,!1);this.back=new Worldcore.THREE.Mesh(t,i),this.back.position.set(0,0,.04),this.shape.add(this.back),this.addEventListener("pointerMove","pointerMove")}pointerMove(t){if(t.xyz&&this.downInfo){let e=new Worldcore.THREE.Vector3(...t.xyz);var t=this.renderObject.matrixWorld.clone().invert(),t=(e=e.applyMatrix4(t),this.downInfo.downPosition),i=this.downInfo.childTranslation,s=e.x-t.x,t=e.y-t.y;this.downInfo.child.say("setTranslation",[i[0]+s,i[1]+t,i[2]])}}}]},{name:"PropertySheetWindow",actorBehaviors:[class PropertySheetWindowActor{setup(){this.dismiss&&this.dismiss.destroy(),this.dismiss=this.createCard({translation:this.dismissButtonPosition(),name:"dismiss window",behaviorModules:["PropertySheetDismiss"],parent:this,type:"object",noSave:!0}),this.subscribe(this.dismiss.id,"dismiss","dismissWindow")}dismissButtonPosition(){return[this._cardData.width/2-.062,this._cardData.height/2-.062,.031]}dismissWindow(e){this.destroy()}setObject(){console.log("set object")}}],pawnBehaviors:[class PropertySheetWindowPawn{setup(){this.frame&&(this.shape.remove(this.frame),this.frame=null),this.back&&(this.shape.remove(this.back),this.back=null),this.shape.children=[];var e={x:this.actor._cardData.width,y:this.actor._cardData.height},t=this.roundedCornerGeometry(e.x,e.y,1e-4,.02),i=this.makePlaneMaterial(.02,0,0,!1),t=(this.frame=new Worldcore.THREE.Mesh(t,i),this.frame.position.set(0,0,.021),this.shape.add(this.frame),this.roundedCornerGeometry(e.x-.02,e.y-.02,1e-4,.02)),i=this.makePlaneMaterial(.02,16777215,16777215,!1);this.back=new Worldcore.THREE.Mesh(t,i),this.back.position.set(0,0,.022),this.shape.add(this.back),this.addEventListener("pointerDown","pointerDown"),this.addEventListener("pointerUp","pointerUp"),this.listen("cardDataSet","cardDataUpdated")}cardDataUpdated(){console.log(this.actor._cardData.width,this.actor._cardData.height)}pointerDown(a){if(a.xyz){let e=new Worldcore.THREE.Vector3(...a.xyz);var r=this.renderObject.matrixWorld.clone().invert();e=e.applyMatrix4(r);let t=this.actor._cardData.width,i=this.actor._cardData.height,s={};if(e.x<-t/2+.05&&(s.x="left"),e.x>t/2-.05&&(s.x="right"),e.y<-i/2+.05&&(s.y="bottom"),e.y>i/2-.05&&(s.y="top"),s.x||s.y){let e=this._parent,t=new Worldcore.THREE.Vector3(...a.xyz);r=e.renderObject.matrixWorld.clone().invert(),r=(t=t.applyMatrix4(r),{...s,child:this,childTranslation:this._translation,downPosition:t});this._parent.downInfo=r,this.didSetDownInfo=!0;let i=this.service("PawnManager").get(a.avatarId);i&&i.addFirstResponder("pointerMove",{},this._parent)}}}pointerUp(t){if(this.didSetDownInfo&&this._parent){delete this._parent.downInfo;let e=this.service("PawnManager").get(t.avatarId);e&&e.removeFirstResponder("pointerMove",{},this._parent)}}}]},{name:"PropertySheetDismiss",actorBehaviors:[class PropertySheetDismissActor{setup(){}}],pawnBehaviors:[class PropertySheetDismissPawn{setup(){this.addEventListener("pointerTap","tap"),this.back&&(this.shape.remove(this.back),this.shape.children=[]);var e=void 0!==this.actor._cardData.backgroundColor?this.actor._cardData.backgroundColor:13421772,t=void 0!==this.actor._cardData.color?this.actor._cardData.color:2236962,i=new Worldcore.THREE.BoxGeometry(.08,.08,1e-5),e=new Worldcore.THREE.MeshStandardMaterial({color:e,side:Worldcore.THREE.DoubleSide}),i=(this.back=new Worldcore.THREE.Mesh(i,e),new Worldcore.THREE.BoxGeometry(.07,.02,.001)),e=new Worldcore.THREE.MeshStandardMaterial({color:t,side:Worldcore.THREE.DoubleSide});let s=new Worldcore.THREE.Mesh(i,e);s.position.set(0,0,1e-5),this.back.add(s),this.shape.add(this.back)}tap(e){this.publish(this.actor.id,"dismiss",this.actor.parent.id)}}]},{name:"PropertySheetEdit",actorBehaviors:[class PropertySheetEditActor{setup(){this.listen("launchCodeEditor","launchCodeEditor")}launchCodeEditor(e){console.log(e.pose),this.createCard({name:"code editor",translation:e.pose.translation,rotation:e.pose.rotation,layers:["pointer"],type:"code",behaviorModule:e.name,margins:{left:32,top:32,right:32,bottom:32},textScale:.001,width:1.5,height:2,depth:.05,frameColor:8947848})}}],pawnBehaviors:[class PropertySheetEditPawn{setup(){this.addEventListener("pointerTap","tap")}tap(s){let a=this.service("PawnManager").get(s.avatarId);if(a&&this.shape.name){s=this.shape.name.indexOf(" "),s=this.shape.name.slice(0,s);let i;var r,o,h,s=this.actor.behaviorManager.modules.get(s);if(s){s.actorBehaviors&&0<s.actorBehaviors.size&&([o,r]=[...s.actorBehaviors][0],i=s.name+"."+o),i||s.pawnBehaviors&&0<s.pawnBehaviors.size&&([o,h]=[...s.pawnBehaviors][0],i=s.name+"."+o);let e=new Worldcore.THREE.Vector3,t=(e.setFromMatrixPosition(this.shape.matrixWorld),a.dropPose(6));t.translation=[e.x,e.y,e.z],i&&this.say("launchCodeEditor",{name:i,pose:t})}}}}]},{name:"PropertySheetWindowBar",actorBehaviors:[class PropertySheetWindowBarActor{setup(){}}],pawnBehaviors:[class PropertySheetWindowBarPawn{setup(){this.addEventListener("pointerDown","pointerDown"),this.addEventListener("pointerMove","pointerMove"),this.addEventListener("pointerUp","pointerUp"),this.back&&(this.shape.remove(this.back),this.shape.children=[]);var e=new Worldcore.THREE.BoxGeometry(.022,.022,1e-5),t=new Worldcore.THREE.MeshStandardMaterial({color:8921634,side:Worldcore.THREE.DoubleSide}),e=(this.back=new Worldcore.THREE.Mesh(e,t),new Worldcore.THREE.BoxGeometry(.02,.005,.001)),t=new Worldcore.THREE.MeshStandardMaterial({color:0,side:Worldcore.THREE.DoubleSide});let i=new Worldcore.THREE.Mesh(e,t);i.position.set(0,0,1e-5),this.back.add(i),this.shape.add(this.back)}tap(e){this.publish(this.actor.id,"dismiss",this.actor.parent.id)}}]},{name:"BehaviorMenu",actorBehaviors:[class BehaviorMenuActor{show(){this.menu&&this.menu.destroy(),this.menu=this.createCard({name:"behavior menu",behaviorModules:["Menu"],multiple:!0,parent:this,type:"2d",noSave:!0,depth:.01,cornerRadius:.05,menuIcons:{_:"edit.svg",apply:null,"------------":null}}),this.subscribe(this.menu.id,"itemsUpdated","itemsUpdated"),this.updateSelections(),this.listen("fire","setBehaviors"),this.subscribe(this._cardData.target,"behaviorUpdated","updateSelections")}updateSelections(){console.log("updateSelections");let t=this.service("ActorManager").get(this._cardData.target),i=[],e=[...this.behaviorManager.modules].filter(([,e])=>!e.systemModule);e.forEach(([e])=>{e={label:e,selected:t._behaviorModules&&0<=t._behaviorModules.indexOf(e)};i.push(e)}),i.push({label:"------------"}),i.push({label:"apply"}),this.menu.call("Menu$MenuActor","setItems",i)}setBehaviors(e){console.log("setBehaviors");let t=this.service("ActorManager").get(this._cardData.target);t.setBehaviors(e.selection)}itemsUpdated(){this.publish(this.id,"extentChanged",{x:this.menu._cardData.width,y:this.menu._cardData.height})}}]},{name:"ActionMenu",actorBehaviors:[class ActionMenuActor{show(){this.menu&&this.menu.destroy(),this.menu=this.createCard({name:"action menu",behaviorModules:["Menu"],parent:this,type:"2d",noSave:!0,depth:.01,cornerRadius:.05}),this.subscribe(this.menu.id,"itemsUpdated","itemsUpdated"),this.updateSelections(),this.listen("fire","doAction")}updateSelections(){console.log("action updateSelections");this.menu.call("Menu$MenuActor","setItems",[{label:"actions"},{label:"------------"},{label:"Duplicate"},{label:"Delete"},{label:"Save"}])}doAction(e){this.publish(this.id,"doAction",e)}itemsUpdated(){this.publish(this.id,"extentChanged",{x:this.menu._cardData.width,y:this.menu._cardData.height})}}]}]}}}]);