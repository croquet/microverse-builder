"use strict";(globalThis.webpackChunk_croquet_microverse=globalThis.webpackChunk_croquet_microverse||[]).push([[770],{9770:(t,e,i)=>{i.r(e),i.d(e,{default:()=>s});const s={modules:[{name:"Drive",actorBehaviors:[class DriveActor{setup(){void 0===this.speed&&(this.speed=.1),void 0===this.angle&&(this.angle=.02),void 0===this.running&&(this.running=!0,this.run()),this.addEventListener("keyDown","control"),this.addEventListener("pointerDown","nop")}run(){var t;this.running&&(this.future(20).run(),this.rotateBy([0,-this.angle,0]),this.forwardBy(-this.speed),this.avatar&&(t=this._translation,this.avatar.translateTo([t[0],t[1]+1.6,t[2]]),this.avatar.rotateTo(this._rotation)))}ride(){let t=this.queryCards();var e=t.find(t=>t.layers.includes("avatar"));this.avatar=e}rotateBy(t){t=Worldcore.q_euler(...t),t=Worldcore.q_multiply(this.rotation,t);this.rotateTo(t)}forwardBy(t){t=Worldcore.v3_rotate([t,0,0],this.rotation);this.translateTo([this.translation[0]+t[0],this.translation[1]+t[1],this.translation[2]+t[2]])}control(t){"ArrowRight"===t.key?this.angle=Math.min(.05,this.angle+.004):"ArrowLeft"===t.key?this.angle=Math.max(-.05,this.angle-.004):"ArrowUp"===t.key?this.speed=Math.min(1,this.speed+.025):"ArrowDown"===t.key&&(this.speed=Math.max(-.2,this.speed-.025))}destroy(){this.removeEventListener("pointerDown","toggle"),this.removeEventListener("keyDown","turn"),this.running=!1}}]},{name:"Circle",actorBehaviors:[class CircleActor{setup(){this.circling||(this.circling=!0,this.step()),this.addEventListener("pointerDown","toggle")}step(){this.circling&&(this.future(20).step(),this.rotateBy([0,.01,0]),this.forwardBy(.03))}toggle(){this.circling=!this.circling,this.circling&&this.step()}rotateBy(t){t=Worldcore.q_euler(...t),t=Worldcore.q_multiply(this.rotation,t);this.rotateTo(t)}forwardBy(t){t=Worldcore.v3_rotate([0,0,t],this.rotation);this.translateTo([this.translation[0]+t[0],this.translation[1]+t[1],this.translation[2]+t[2]])}destroy(){this.removeEventListener("pointerDown","toggle"),this.circling=!1}}]},{name:"Perlin",actorBehaviors:[class PerlinActor{setup(){console.log("PerlinActor");let t=!1;void 0===this.visible&&(t=!0,this.visible=!1),this.initPerlin(t),this.listen("hiliteRequest","hilite"),this.listen("unhiliteRequest","unhilite"),this.listen("showHideRequest","showHide"),this.listen("enterHiliteRequest","enterHilite"),this.listen("leaveHiliteRequest","leaveHilite")}hilite(t){this.say("hilite",530440)}unhilite(t){this.say("hilite",0)}enterHilite(t){this.say("hilite",1579016)}leaveHilite(t){this.say("hilite",0)}initPerlin(t){this.currentRow=this.rows=20,this.columns=20;this.delta=.1;this.data=[...Array(this.rows).keys()].map(e=>[...Array(this.columns).keys()].map(t=>this.call("PerlinNoise","noise2D",.1*e,.1*t))),t&&this.updatePerlin()}updatePerlin(){if(this.future(100).updatePerlin(),this.data){this.data.shift();let e=this.delta;var t=[...Array(this.columns).keys()].map(t=>this.call("PerlinNoise","noise2D",this.currentRow*e,t*e));this.data.push(t),this.currentRow++,this.say("updatePerlin",t)}}showHide(){this.visible=!this.visible,this.say("showMe",this.visible)}},class PerlinNoise{generateHashTable(){const t=[];this.items=[];for(let t=0;t<256;t++)this.push({key:Math.random(),value:t});for(;!this.isEmpty();)t.push(this.pop().value);return t.concat(t)}signedNoise2D(t,e){return this.noise2D(t,e)-.5}noise2D(t,e){this.hashTable||(this.hashTable=this.generateHashTable());var i=this.hashTable,s=Math.floor(t),r=Math.floor(e),t=t-s,e=e-r,h=this.fade(t),o=this.fade(e),s=255&s,r=255&r,a=i[i[s]+r],n=i[i[1+s]+r],l=i[i[s]+r+1],i=i[i[1+s]+r+1],s=this.grad(a,t,e),r=this.grad(n,t-1,e),a=this.grad(l,t,e-1),n=this.grad(i,t-1,e-1),l=this.lerp(s,r,h),i=this.lerp(a,n,h);return(this.lerp(l,i,o)+1)/2}lerp(t,e,i){return t+i*(e-t)}fade(t){return t*t*t*(t*(6*t-15)+10)}grad(t,e,i){switch(3&t){case 0:return e+i;case 1:return e-i;case 2:return-e+i;case 3:return-e-i;default:return 0}}comparator(t,e){return t.key<e.key}isEmpty(){return 0===this.items.length}clear(){this.items.length=0}push(t){let e=this.items.length;for(;0<e&&!this.comparator(this.items[e>>1],t);)this.items[e]=this.items[e>>1],e>>=1;this.items[e]=t}pop(){var t=this.items[0],e=this.items.pop();return 0<this.items.length&&(this.items[0]=e,this.heapify(0)),t}traverse(t){this.items.forEach(t)}heapify(t){let e=t;var i=t<<1,s=1+i;i<this.items.length&&this.comparator(this.items[i],this.items[e])&&(e=i),(e=s<this.items.length&&this.comparator(this.items[s],this.items[e])?s:e)!==t&&(i=this.items[t],this.items[t]=this.items[e],this.items[e]=i,this.heapify(e))}}],pawnBehaviors:[class PerlinPawn{setup(){console.log("PerlinPawn"),this.listen("updatePerlin","updatePerlin"),this.listen("showMe","showMe"),this.listen("hilite","hilite"),this.isConstructed=!1,this.addEventListener("pointerDown","onPointerDown"),this.addEventListener("pointerUp","onPointerUp"),this.addEventListener("pointerEnter","onPointerEnter"),this.addEventListener("pointerLeave","onPointerLeave"),this.addEventListener("pointerTap","click"),this.addEventListener("pointerMove","nop"),this.maxHeight=8,this.barScale=.25,this.perlinGroup&&(this.shape.remove(this.perlinGroup),this.perlinGroup=null),this.perlinGroup&&(this.shape.remove(this.perlinGroup),this.perlinGroup=null),this.buttonSphere&&(this.shape.remove(this.buttonSphere),this.buttonSphere=null),this.constructPerlin()}onPointerDown(t){this.say("hiliteRequest",t)}onPointerUp(t){this.say("unhiliterequest",t)}onPointerEnter(t){this.say("enterHiliteRequest",t)}onPointerLeave(t){this.say("leaveHiliteRequest",t)}click(t){this.say("showHideRequest")}updatePerlin(e){var i=this.actor.rows,s=this.barScale,r=this.rowGeometry.shift();this.rowGeometry.push(r);for(let t=0;t<r.children.length;t++)this.setBar(r.children[t],e[t],i,t);for(let t=0;t<i;t++)this.rowGeometry[t].position.set(0,s/4,(t-i/2)*s)}constructPerlin(){var r=this.actor.data,h=this.actor.rows,t=this.actor.columns,e=this.barScale;this.perlinGroup=new Worldcore.THREE.Group,this.buttonSphere=new Worldcore.THREE.Mesh(new Worldcore.THREE.SphereGeometry(.5,32,16),new Worldcore.THREE.MeshStandardMaterial),this.buttonSphere.name="buttonSphere",this.buttonSphere.position.y=3,this.shape.add(this.buttonSphere),this.color=new Worldcore.THREE.Color,this.base=new Worldcore.THREE.Mesh(new Worldcore.THREE.BoxGeometry((h+2)*e,e/2,(t+2)*e,2,10,2),new Worldcore.THREE.MeshStandardMaterial({color:this.color.getHex()})),this.base.position.set(-e/2,0,-e/2),this.bar=new Worldcore.THREE.Mesh(new Worldcore.THREE.BoxGeometry(e,e,e,1,10,1),new Worldcore.THREE.MeshStandardMaterial({color:this.color.getHex()})),this.base.layers.enable(1),this.base.castShadow=!0,this.base.receiveShadow=!0,this.perlinGroup.add(this.base),this.rowGeometry=[];for(let s=0;s<h;s++){let i=new Worldcore.THREE.Group;i.position.set(0,e/4,(s-h/2)*e);for(let e=0;e<t;e++){let t=this.bar.clone();t.material=t.material.clone();var o=r[s][e];this.setBar(t,o,h,e),i.add(t)}this.rowGeometry.push(i),this.perlinGroup.add(i)}this.showMe(this.actor.visible),this.shape.name="perlin",this.isConstructed=!0}setBar(t,e,i,s){var r=this.barScale,h=Math.cos((1-e)*Math.PI),h=Math.min(1,(h+1)/1.25),o=(Math.sin(e*Math.PI)+1)/2.2,a=Math.cos(e*Math.PI),a=Math.min(1,(a+1)/1.25);t.material.color.setRGB(a,o,h),e*=this.maxHeight,t.position.set((s-i/2)*r,r*e/2,0),t.scale.set(1,e,1)}hilite(t){this.buttonSphere.material.emissive=new Worldcore.THREE.Color(t)}showMe(t){t?this.shape.add(this.perlinGroup):this.shape.remove(this.perlinGroup)}}]}]}}}]);