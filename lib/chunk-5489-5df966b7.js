"use strict";(globalThis.webpackChunk_croquet_microverse=globalThis.webpackChunk_croquet_microverse||[]).push([[5489],{5489:(t,i,e)=>{e.r(i),e.d(i,{default:()=>s});const s={modules:[{name:"SingleUserSpin",actorBehaviors:[class SingleUserSpinActor{setup(){this.listen("startSpinning","startSpinning"),this.listen("stopSpinning","stopSpinning"),this.listen("newAngle","newAngle")}startSpinning(t){this.isSpinning=!0,this.qSpin=Worldcore.q_euler(0,t,0),this.doSpin()}doSpin(){this.isSpinning&&(this.rotateTo(Worldcore.q_multiply(this._rotation,this.qSpin)),this.future(50).doSpin())}stopSpinning(){this.isSpinning=!1}newAngle(t){this.publish("scope","newAngle",t)}teardown(){delete this.isSpinning,this.unsubscribe(this.id,"startSpinning"),this.unsubscribe(this.id,"stopSpinning"),this.unsubscribe(this.id,"newAngle")}}],pawnBehaviors:[class SingleUserSpinPawn{setup(){this.addEventListener("pointerDown","onPointerDown"),this.addEventListener("pointerUp","onPointerUp"),this.addEventListener("pointerMove","onPointerMove"),this.listen("focusChanged","focusChanged")}isSingleUser(){return void 0!==this.actor.occupier}hasFocus(){return this.actor.occupier==this.viewId}theta(t){var i=this.translation;return(Math.atan2(i[2]-t[2],t[0]-i[0])+2*Math.PI)%(2*Math.PI)}onPointerDown(t){if(!this.isSingleUser())return this.downP3d=t,void this.focusChanged();this.say("focus",this.viewId),this.downP3d=t}focusChanged(){if(this.isSingleUser()&&!this.hasFocus())this.downP3d&&this.onPointerUp(this.downP3d);else{var i=this.downP3d;if(i){this.moveBuffer=[],this.say("stopSpinning"),this._startDrag=i.xy,this._baseRotation=this._rotation;let t=Worldcore.GetPawn(i.avatarId);t.addFirstResponder("pointerMove",{},this)}}}onPointerMove(t){this.isSingleUser()&&!this.hasFocus()||this.downP3d&&(this.moveBuffer.push(t.xy),this.deltaAngle=(t.xy[0]-this._startDrag[0])/2/180*Math.PI,t=Worldcore.q_multiply(this._baseRotation,Worldcore.q_euler(0,this.deltaAngle,0)),this.rotateTo(t),this.say("newAngle",this.deltaAngle),this.say("focus",this.viewId),3<=this.moveBuffer.length&&setTimeout(()=>this.shiftMoveBuffer(),100))}shiftMoveBuffer(){this.moveBuffer.shift()}onPointerUp(t){this.say("unfocus",this.viewId),this.downP3d=null;let i=Worldcore.GetPawn(t.avatarId);if(i.removeFirstResponder("pointerMove",{},this),(!this.isSingleUser()||this.hasFocus())&&(this.moveBuffer.push(t.xy),this._startDrag=null,this._baseRotation=null,!(this.moveBuffer.length<3))){this.moveBuffer=this.moveBuffer.slice(this.moveBuffer.length-3);let i=new Set;for(let t=0;t<this.moveBuffer.length-1;t++)i.add(Math.sign(this.moveBuffer[t+1][0]-this.moveBuffer[t][0]));i.has(-1)&&i.has(1)||(this.deltaAngle=(this.moveBuffer[this.moveBuffer.length-1][0]-this.moveBuffer[0][0])/2/180*Math.PI,.01<Math.abs(this.deltaAngle)&&(t=this.deltaAngle,t=Math.min(Math.max(-.1,t),.1),this.say("startSpinning",t)))}}teardown(){this.removeEventListener("pointerDown","onPointerDown"),this.removeEventListener("pointerUp","onPointerUp"),this.removeEventListener("pointerMove","onPointerMove")}}]}]}}}]);